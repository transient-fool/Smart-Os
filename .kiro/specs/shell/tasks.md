# Shell 实现任务列表

## 实现计划

- [x] 1. 扩展 UART 驱动支持非阻塞输入


  - 实现 `smart_uart_getc_nonblock()` 函数
  - 实现 `smart_uart_input_available()` 函数
  - _需求: 1.1, 8.3_

- [x] 2. 创建 Shell 核心框架


  - [x] 2.1 创建 `smart_shell.h` 头文件


    - 定义 Shell 公共接口
    - 定义命令处理函数类型
    - _需求: 10.1_

  
  - [x] 2.2 创建 `smart_shell.c` 实现文件

    - 定义 Shell 上下文结构
    - 定义命令表结构
    - _需求: 10.2_
  
  - [x] 2.3 实现 Shell 初始化函数

    - 初始化 Shell 上下文
    - 创建 Shell 任务
    - _需求: 8.1_

- [x] 3. 实现输入处理模块

  - [x] 3.1 实现字符接收和回显

    - 非阻塞读取 UART 输入
    - 回显可打印字符
    - _需求: 1.1_
  
  - [x] 3.2 实现退格处理

    - 删除缓冲区最后一个字符
    - 更新终端显示（发送退格序列）
    - _需求: 1.3_
  
  - [x] 3.3 实现回车处理

    - 添加字符串结束符
    - 触发命令执行
    - _需求: 1.2_
  
  - [x] 3.4 实现缓冲区溢出保护

    - 检查缓冲区剩余空间
    - 拒绝新输入并提示
    - _需求: 1.4_

- [x] 4. 实现命令解析模块

  - [x] 4.1 实现命令行分词函数

    - 按空格分割命令和参数
    - 处理多个连续空格
    - 返回参数数量
    - _需求: 2.1, 2.2_
  
  - [x] 4.2 实现空命令处理

    - 检测空行或纯空格
    - 直接显示新提示符
    - _需求: 2.3_

- [x] 5. 实现命令分发模块

  - [x] 5.1 实现命令查找函数

    - 在命令表中查找命令名
    - 返回命令处理函数指针
    - _需求: 2.4_
  
  - [x] 5.2 实现命令执行函数

    - 调用命令处理函数
    - 传递参数
    - 处理返回值
    - _需求: 10.3_
  
  - [x] 5.3 实现参数验证

    - 检查参数数量
    - 显示用法提示
    - _需求: 2.5_

- [x] 6. 实现命令提示符

  - [x] 6.1 实现欢迎信息显示

    - 显示系统名称和版本
    - 显示简短使用提示
    - _需求: 6.1_
  
  - [x] 6.2 实现提示符显示

    - 显示 "SmartOS> " 提示符
    - 确保光标位置正确
    - _需求: 6.2, 6.3, 6.4_

- [x] 7. 实现基本命令

  - [x] 7.1 实现 help 命令

    - 遍历命令表
    - 显示命令名和描述
    - _需求: 3.1_
  
  - [x] 7.2 实现 version 命令

    - 显示系统版本号
    - 显示编译日期
    - _需求: 3.2_
  
  - [x] 7.3 实现 uptime 命令

    - 获取系统 tick 计数
    - 转换为可读时间格式
    - _需求: 3.3_
  
  - [x] 7.4 实现 clear 命令

    - 发送 ANSI 清屏序列
    - 重置光标位置
    - _需求: 3.5_

- [ ] 8. 实现系统信息命令
  - [ ] 8.1 扩展 smart_core.c 添加任务遍历接口
    - 实现 `smart_get_task_list()` 函数
    - 返回任务信息数组
    - _需求: 3.4_
  
  - [ ] 8.2 实现 ps 命令
    - 调用任务遍历接口
    - 格式化显示任务信息
    - _需求: 3.4_
  
  - [ ] 8.3 实现 meminfo 命令
    - 获取内存池统计信息
    - 显示总块数、已用、空闲
    - _需求: 4.1, 4.3_
  
  - [ ] 8.4 实现 free 命令
    - 获取可用内存块数
    - 显示简洁的内存信息
    - _需求: 4.2_

- [ ] 9. 实现文件系统命令
  - [x] 9.1 实现 ls 命令

    - 调用 `smart_fs_list_dir()`
    - 格式化显示文件列表
    - _需求: 5.1_
  
  - [x] 9.2 实现 cat 命令

    - 打开指定文件
    - 读取并显示内容
    - 处理文件不存在错误
    - _需求: 5.2_
  
  - [ ] 9.3 实现 format 命令
    - 调用 `smart_fs_format()`
    - 显示格式化进度
    - 提示成功或失败
    - _需求: 5.3_
  
  - [ ] 9.4 实现 fsinfo 命令
    - 显示文件系统类型
    - 显示总大小和使用率
    - 处理未初始化情况
    - _需求: 5.4, 5.5_

- [ ] 10. 实现错误处理
  - [x] 10.1 实现未知命令错误

    - 显示 "Unknown command" 消息
    - 提示使用 help 查看命令
    - _需求: 7.1_
  
  - [x] 10.2 实现参数错误处理

    - 显示命令用法
    - 提供参数格式示例
    - _需求: 7.2_
  
  - [x] 10.3 实现文件系统错误处理

    - 文件不存在错误
    - 文件系统未初始化错误
    - _需求: 7.3, 5.5_
  
  - [ ] 10.4 实现内存错误处理
    - 内存不足提示
    - 继续运行不崩溃
    - _需求: 7.4, 7.5_

- [x] 11. 集成和测试

  - [x] 11.1 在 main.c 中集成 Shell
    - 调用 `smart_shell_init()`
    - 配置 Shell 任务优先级
    - _需求: 8.1, 8.2_
  
  - [x] 11.2 测试基本输入输出
    - 测试字符回显 ✓
    - 测试退格功能 ✓
    - 测试缓冲区溢出 ✓
    - _需求: 1.1, 1.3, 1.4_
  
  - [x] 11.3 测试命令执行
    - 测试所有内置命令 ✓
    - 测试错误情况 ✓
    - 测试参数解析 ✓
    - _需求: 2.1, 2.4, 2.5_
  
  - [x] 11.4 测试任务并发
    - 验证 Shell 不阻塞其他任务 ✓
    - 验证其他任务正常运行 ✓
    - _需求: 8.4_

- [ ] 12. 优化和文档
  - [ ] 12.1 性能优化
    - 减少不必要的 UART 输出
    - 优化命令查找算法
    - _非功能需求: 性能_
  
  - [ ] 12.2 代码清理
    - 添加注释
    - 统一代码风格
    - _非功能需求: 可维护性_
  
  - [ ] 12.3 更新文档
    - 更新 README 添加 Shell 使用说明
    - 创建命令参考文档
    - _非功能需求: 可用性_

## 注意事项

1. **任务优先级**: Shell 任务应设置为低优先级，避免影响实时任务
2. **栈大小**: Shell 任务栈建议 1024 字节，确保足够空间
3. **UART 配置**: 确保 UART 波特率正确（115200）
4. **测试**: 每完成一个模块立即测试，避免问题累积
5. **错误处理**: 所有命令都应有完善的错误处理，不应导致系统崩溃
